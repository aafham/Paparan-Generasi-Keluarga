<!doctype html>
<html lang="ms">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Salasilah Keluarga</title>
  <meta name="theme-color" content="#4f8a6a" />
  <link rel="manifest" href="manifest.json" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@300;400;600;700&family=Source+Sans+3:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="app" id="app" data-theme="light">
    <header class="topbar">
      <div class="brand">
        <p class="kicker" data-i18n="appKicker">Salasilah Keluarga</p>
        <h1 data-i18n="appTitle">Paparan Generasi Keluarga</h1>
        <p class="subtitle" data-i18n="appSubtitle">Semua ahli keluarga dalam satu pandangan yang jelas, mudah, dan mesra.</p>
        <div class="brand-minimap-wrap">
          <div class="minimap-label" data-i18n="minimapTitle">Minimap</div>
          <div class="minimap minimap-brand" id="minimap">
            <canvas id="minimap-canvas"></canvas>
          </div>
          <p class="minimap-hint" data-i18n="minimapHint">Klik pada kotak kecil untuk lompat lokasi. Kotak putih menunjukkan kawasan semasa.</p>
          <button class="minimap-handle" id="minimap-handle" type="button" data-i18n="minimapShow">Buka Minimap</button>
        </div>
      </div>
      <div class="top-actions" aria-label="Quick actions">
        <label class="toggle">
          <input id="toggle-theme" type="checkbox" />
          <span class="toggle-track"></span>
          <span class="toggle-label" data-i18n="themeToggle">Light / Dark</span>
        </label>
        <label class="toggle">
          <input id="lang-toggle" type="checkbox" />
          <span class="toggle-track"></span>
          <span class="toggle-label" data-i18n="langToggle">BM / EN</span>
        </label>
        <button id="clear-cache" class="btn danger small" type="button" data-i18n-title="clearCache" data-i18n-aria="clearCache">
          <span class="btn-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" role="img" focusable="false">
              <path d="M20 5v6h-6" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M20 11a8 8 0 1 1-2.34-5.66" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
            </svg>
          </span>
          <span class="btn-text" data-i18n="clearCache">Clear Cache</span>
        </button>
      </div>
      <div class="controls">
        <div class="control-group">
          <label for="search" class="label" data-i18n="searchLabel">Carian nama</label>
          <div class="search-row">
            <input id="search" type="search" placeholder="Cari nama ahli keluarga..." data-i18n-placeholder="searchPlaceholder" />
            <button id="search-go" class="btn ghost small" data-i18n="searchGo">Cari & Fokus</button>
          </div>
          <div id="search-results" class="search-results" aria-live="polite"></div>
        </div>
        <div class="control-group" hidden>
          <label for="branch-filter" class="label" data-i18n="branchLabel">Tapis cabang</label>
          <select id="branch-filter" class="select"></select>
        </div>
        <div class="mobile-actions" aria-label="Aksi mudah alih">
          <div class="control-row mobile-quick">
            <button class="btn" id="m-zoom-in" data-action="zoom-in" data-i18n="zoomIn">Zoom +</button>
            <button class="btn" id="m-zoom-out" data-action="zoom-out" data-i18n="zoomOut">Zoom -</button>
            <button class="btn ghost" id="m-zoom-fit" data-action="zoom-fit" data-i18n="fit">Fit Skrin</button>
          </div>
          <div class="control-group mobile-select">
            <label class="label" id="mobile-action-label" for="mobile-action" data-i18n="mobileActions">Aksi lain</label>
            <select id="mobile-action" class="select">
              <option value="" data-i18n="mobilePick">Pilih aksi...</option>
              <option value="zoom-reset" data-i18n="zoomReset">Reset</option>
              <option value="focus-elders" data-i18n="focusElders">Fokus Tok/Wan</option>
              <option value="back-top" data-i18n="backTop">Kembali Atas</option>
              <option value="path-toggle" data-i18n="pathOff">Laluan Saya</option>
              <option value="compact-toggle" data-i18n="compactOff">Mode Ringkas</option>
              <option value="view-toggle" data-i18n="viewTimeline">Lihat Timeline</option>
              <option value="export-png" data-i18n="exportPng">Export PNG</option>
              <option value="export-pdf" data-i18n="exportPdf">Export PDF</option>
              <option value="validate-data" data-i18n="validateData">Validasi Data</option>
              <option value="editor-toggle" data-i18n="editorToggle">Editor Data</option>
            </select>
            <button id="mobile-action-go" class="btn ghost" disabled data-i18n="okBtn">OK</button>
          </div>
        </div>
        <div class="control-row actions-zoom">
          <button id="zoom-in" class="btn" data-i18n="zoomIn">Zoom +</button>
          <button id="zoom-out" class="btn" data-i18n="zoomOut">Zoom -</button>
          <button id="zoom-reset" class="btn ghost" data-i18n="zoomReset">Reset</button>
          <button id="zoom-fit" class="btn ghost" data-i18n="fit">Fit Skrin</button>
        </div>
        <div id="validate-output" class="validate-output" aria-live="polite"></div>
        <div class="control-group generation-row">
          <div>
            <label class="label" data-i18n="generationLabel">Generasi (Collapse/Expand)</label>
            <div id="generation-controls" class="generation-controls"></div>
          </div>
          <div class="export-actions">
          <button id="export-png" class="btn ghost" data-i18n-title="exportPng" data-i18n-aria="exportPng" title="Export PNG" aria-label="Export PNG">
              <span class="btn-icon" aria-hidden="true">
                <svg viewBox="0 0 24 24" role="img" focusable="false">
                  <path d="M6 3h9l5 5v13a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1z" fill="none" stroke="currentColor" stroke-width="1.6"/>
                  <path d="M15 3v5h5" fill="none" stroke="currentColor" stroke-width="1.6"/>
                  <path d="M7.5 17.5l3-3 2 2 2.5-2.5 2.5 3.5" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                  <circle cx="9" cy="11" r="1.5" fill="currentColor"/>
                </svg>
              </span>
              <span class="sr-only" data-i18n="exportPng">Export PNG</span>
            </button>
          <button id="export-pdf" class="btn ghost" data-i18n-title="exportPdf" data-i18n-aria="exportPdf" title="Export PDF" aria-label="Export PDF">
              <span class="btn-icon" aria-hidden="true">
                <svg viewBox="0 0 24 24" role="img" focusable="false">
                  <path d="M6 3h9l5 5v13a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1z" fill="none" stroke="currentColor" stroke-width="1.6"/>
                  <path d="M15 3v5h5" fill="none" stroke="currentColor" stroke-width="1.6"/>
                  <path d="M8 16h8" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
                  <path d="M8 13h8" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
                </svg>
              </span>
              <span class="sr-only" data-i18n="exportPdf">Export PDF</span>
            </button>
          </div>
        </div>
      </div>
    </header>

    <section class="legend">
      <div class="legend-item">
        <span class="legend-dot"></span>
        <span data-i18n="legendParentChild">Garis sambungan ibu bapa → anak</span>
      </div>
      <div class="legend-item">
        <span class="legend-couple"></span>
        <span data-i18n="legendCouple">Pasangan ditunjukkan secara selari</span>
      </div>
    </section>

    <main class="tree-section">
      <div class="content-grid">
        <div class="tree-wrap" id="tree-wrap">
          <div class="tree-zoom" id="tree-zoom">
            <svg class="tree-lines" id="tree-lines" xmlns="http://www.w3.org/2000/svg"></svg>
            <div class="tree-canvas" id="tree-canvas" aria-live="polite"></div>
          </div>
        </div>
        <aside class="story-panel" id="story-panel" hidden>
          <div class="story-head">
            <h2 id="story-title">Cerita Keluarga</h2>
            <div class="story-actions">
              <button id="panel-close" class="btn ghost small close-btn" aria-label="Tutup">
                <span aria-hidden="true">×</span>
              </button>
              <button id="panel-edit" class="btn ghost small" data-i18n="modalEdit">Edit</button>
            </div>
          </div>
          <div id="story-content" class="story-content">
            <p id="story-body">Klik pada mana-mana ahli keluarga untuk melihat catatan panjang.</p>
          </div>
          <form class="story-edit" id="panel-edit-form" hidden>
            <label data-i18n="modalFullName">Nama penuh</label>
            <input class="input" id="panel-edit-name" />
            <label data-i18n="firstNameLabel">Nama pertama</label>
            <input class="input" id="panel-edit-first" readonly />
            <label data-i18n="lastNameLabel">Nama akhir</label>
            <input class="input" id="panel-edit-last" readonly />
            <div class="radio-group">
              <span class="label" data-i18n="genderLabel">Jantina</span>
              <label class="radio">
                <input type="radio" name="panel-gender" value="male" disabled />
                <span data-i18n="genderMale">Lelaki</span>
              </label>
              <label class="radio">
                <input type="radio" name="panel-gender" value="female" disabled />
                <span data-i18n="genderFemale">Perempuan</span>
              </label>
            </div>
            <label data-i18n="modalRelation">Hubungan</label>
            <input class="input" id="panel-edit-relation" />
            <label data-i18n="modalBirth">Tarikh lahir</label>
            <input class="input" id="panel-edit-birth" type="date" />
            <label data-i18n="modalDeath">Tarikh meninggal</label>
            <input class="input" id="panel-edit-death" type="date" />
            <label data-i18n="modalImage">URL gambar</label>
            <input class="input" id="panel-edit-photo" />
            <input class="input" id="panel-edit-photo-file" type="file" accept="image/*" />
            <label data-i18n="modalShortNote">Nota ringkas</label>
            <textarea class="textarea" id="panel-edit-note"></textarea>
            <label data-i18n="modalLongStory">Cerita panjang</label>
            <textarea class="textarea" id="panel-edit-story"></textarea>
            <div class="story-edit-actions">
              <button type="button" class="btn ghost" id="panel-cancel" data-i18n="modalCancel">Batal</button>
              <button type="submit" class="btn" data-i18n="modalSave">Simpan</button>
            </div>
          </form>
        </aside>
        <aside class="editor-panel" id="editor-panel" hidden>
          <h2 data-i18n="editorTitle">Editor Ahli Keluarga</h2>
          <div class="editor-grid">
            <label class="label" for="editor-person" data-i18n="editorPersonLabel">Pilih ahli</label>
            <select id="editor-person" class="select"></select>

            <label class="label" for="editor-name" data-i18n="editorNameLabel">Nama penuh</label>
            <input id="editor-name" class="input" type="text" />

            <label class="label" for="editor-relation" data-i18n="editorRelationLabel">Hubungan</label>
            <input id="editor-relation" class="input" type="text" />

            <label class="label" for="editor-birth" data-i18n="editorBirthLabel">Tarikh lahir</label>
            <input id="editor-birth" class="input" type="date" />

            <label class="label" for="editor-death" data-i18n="editorDeathLabel">Tarikh meninggal</label>
            <input id="editor-death" class="input" type="date" />

            <label class="label" for="editor-photo" data-i18n="editorPhotoLabel">URL gambar</label>
            <input id="editor-photo" class="input" type="text" />
            <input id="editor-photo-file" class="input" type="file" accept="image/*" />

            <label class="label" for="editor-note" data-i18n="editorNoteLabel">Nota ringkas</label>
            <textarea id="editor-note" class="textarea"></textarea>

            <label class="label" for="editor-story" data-i18n="editorStoryLabel">Cerita panjang</label>
            <textarea id="editor-story" class="textarea"></textarea>

            <label class="label" for="editor-parent" data-i18n="editorParentLabel">Tambah sebagai anak kepada pasangan</label>
            <select id="editor-parent" class="select"></select>

            <label class="label" for="editor-partner" data-i18n="editorPartnerLabel">Tambah pasangan kepada ahli dipilih</label>
            <select id="editor-partner" class="select"></select>

          </div>
          <div class="editor-actions">
            <button id="editor-save" class="btn" data-i18n="editorSave">Simpan</button>
            <button id="editor-add" class="btn ghost" data-i18n="editorAdd">Tambah Ahli Baru</button>
            <button id="editor-link-partner" class="btn ghost" data-i18n="editorLinkPartner">Bina Pasangan</button>
            <button id="editor-delete" class="btn danger" data-i18n="editorDelete">Padam</button>
          </div>
          <p class="editor-hint" data-i18n="editorHint">Data disimpan di pelayar (localStorage). Guna Export PNG/PDF untuk kongsi, atau kemas kini data.json bila perlu.</p>
        </aside>
      </div>
      <section class="timeline-section" id="timeline-section" hidden>
        <h2 data-i18n="timelineTitle">Timeline Keluarga</h2>
        <div class="timeline-list" id="timeline-list"></div>
      </section>
    </main>
  </div>

  <div class="modal" id="person-modal" aria-hidden="true">
    <div class="modal-backdrop" data-close="true"></div>
    <div class="modal-card" role="dialog" aria-modal="true">
      <button class="modal-close" data-close="true" data-i18n="modalClose">Tutup</button>
      <div class="modal-body" id="modal-body"></div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="app.js"></script>
</body>
</html>
