<!doctype html>
<html lang="ms">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Salasilah Keluarga</title>
  <meta name="theme-color" content="#4f8a6a" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@300;400;600;700&family=Source+Sans+3:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css?v=20260208" />
</head>
<body>
  <div class="app" id="app" data-theme="light">
    <header class="topbar">
      <div id="mobile-topbar" class="mobile-topbar" aria-label="Mobile top bar">
        <button id="mobile-settings-btn" class="btn ghost icon" type="button" aria-label="Settings">⚙️</button>
        <button id="mobile-search-btn" class="btn ghost icon" type="button" aria-label="Search">🔎</button>
      </div>
      <div class="brand">
        <p class="kicker" data-i18n="appKicker">Salasilah Keluarga</p>
        <h1 data-i18n="appTitle">Paparan Generasi Keluarga</h1>
        <p class="subtitle" data-i18n="appSubtitle">Semua ahli keluarga dalam satu pandangan yang jelas, mudah, dan mesra.</p>
        <div class="brand-minimap-wrap">
          <div class="minimap-label" data-i18n="minimapTitle">Minimap</div>
          <div class="minimap minimap-brand" id="minimap">
            <canvas id="minimap-canvas"></canvas>
          </div>
          <button class="minimap-close" id="minimap-close-btn" type="button" aria-label="Tutup minimap">×</button>
          <p class="minimap-hint" data-i18n="minimapHint">Klik pada kotak kecil untuk lompat lokasi. Kotak putih menunjukkan kawasan semasa.</p>
          <button class="minimap-handle" id="minimap-handle" type="button" data-i18n="minimapShow">Buka Minimap</button>
        </div>
      </div>
      <div class="top-actions" aria-label="Quick actions">
        <button id="settings-btn" class="btn ghost small" type="button" data-i18n="settingsTitle">
          Settings
        </button>
      </div>
      <div id="bottom-sheet" class="bottom-sheet">
        <div id="sheet-handle" class="sheet-handle" role="button" aria-label="Toggle panel"></div>
        <div class="controls">
          <button id="controls-toggle" class="controls-toggle" type="button">Tutup Panel</button>
          <div class="control-group">
            <label for="search" class="label" data-i18n="searchLabel">Carian nama</label>
            <div class="search-row">
              <input id="search" type="search" placeholder="Cari nama ahli keluarga..." data-i18n-placeholder="searchPlaceholder" />
              <button id="search-go" class="btn ghost small" data-i18n="searchGo">Cari & Fokus</button>
            </div>
            <div id="search-results" class="search-results" aria-live="polite"></div>
          </div>
          <div class="control-group" hidden>
            <label for="branch-filter" class="label" data-i18n="branchLabel">Tapis cabang</label>
            <select id="branch-filter" class="select"></select>
          </div>
          <div class="mobile-actions" aria-label="Aksi mudah alih">
            <div class="control-row mobile-quick">
              <button class="btn" id="m-zoom-in" data-action="zoom-in" data-i18n="zoomIn">Zoom +</button>
              <button class="btn" id="m-zoom-out" data-action="zoom-out" data-i18n="zoomOut">Zoom -</button>
              <button class="btn ghost" id="m-zoom-fit" data-action="zoom-fit" data-i18n="fit">Fit Skrin</button>
            </div>
            <div class="control-group mobile-select">
              <label class="label" id="mobile-action-label" for="mobile-action" data-i18n="mobileActions">Aksi lain</label>
              <select id="mobile-action" class="select">
                <option value="" data-i18n="mobilePick">Pilih aksi...</option>
                <option value="zoom-reset" data-i18n="zoomReset">Reset</option>
                <option value="reset-view" data-i18n="resetView">Reset View</option>
                <option value="view-toggle" data-i18n="viewTimeline">Lihat Timeline</option>
                <option value="export-png" data-i18n="exportPng">Image (JPEG)</option>
                <option value="export-pdf" data-i18n="exportPdf">File (PDF)</option>
              </select>
              <button id="mobile-action-go" class="btn ghost" disabled data-i18n="okBtn">OK</button>
            </div>
          </div>
          <div class="control-row actions-zoom">
            <button id="zoom-in" class="btn" data-i18n="zoomIn">Zoom +</button>
            <button id="zoom-out" class="btn" data-i18n="zoomOut">Zoom -</button>
            <button id="zoom-reset" class="btn ghost" data-i18n="zoomReset">Reset</button>
            <button id="zoom-fit" class="btn ghost" data-i18n="fit">Fit Skrin</button>
            <button id="reset-view" class="btn ghost" data-i18n="resetView">Reset View</button>
            <button id="view-toggle" class="btn ghost" data-i18n="viewTimeline">Lihat Timeline</button>
          </div>
          <div id="validate-output" class="validate-output" aria-live="polite"></div>
          <div class="control-group generation-row">
            <div>
              <label class="label" data-i18n="generationLabel">Generasi (Collapse/Expand)</label>
              <div id="generation-controls" class="generation-controls"></div>
            </div>
            <div class="export-actions">
              <button id="export-menu-btn" class="btn ghost" type="button" data-i18n="exportMenu">Download</button>
              <div id="export-menu" class="export-menu" hidden>
                <button id="export-png" class="btn ghost small" type="button" data-i18n="exportPng">Image (JPEG)</button>
                <button id="export-pdf" class="btn ghost small" type="button" data-i18n="exportPdf">File (PDF)</button>
              </div>
            </div>
          </div>
        </div>
        <button id="mobile-panel-btn" class="mobile-panel-btn" type="button">Buka Panel</button>
      </div>
    </header>

    <section class="stats" id="stats">
      <div class="stat-card">
        <div class="stat-label" data-i18n="statsPeople">Jumlah Ahli</div>
        <div class="stat-value" id="stat-people">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-label" data-i18n="statsCouples">Jumlah Pasangan</div>
        <div class="stat-value" id="stat-couples">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-label" data-i18n="statsMale">Lelaki</div>
        <div class="stat-value" id="stat-male">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-label" data-i18n="statsFemale">Perempuan</div>
        <div class="stat-value" id="stat-female">0</div>
      </div>
    </section>
    <div class="view-switch" role="group" aria-label="View switch">
      <button id="view-tree-btn" class="btn ghost small" type="button" data-i18n="viewTree">Lihat Tree</button>
      <button id="view-timeline-btn" class="btn ghost small" type="button" data-i18n="viewTimeline">Lihat Timeline</button>
    </div>

    <main class="tree-section">
      <div id="mini-toolbar" class="mini-toolbar" aria-label="Quick nav">
        <button id="mini-search" class="btn ghost small" type="button" data-i18n="searchGo">Cari & Fokus</button>
        <button id="mini-zoom-in" class="btn small" type="button">+</button>
        <button id="mini-zoom-out" class="btn small" type="button">−</button>
        <button id="mini-zoom-fit" class="btn ghost small" type="button" data-i18n="fit">Fit Skrin</button>
      </div>
      <div class="content-grid">
        <div class="tree-wrap" id="tree-wrap">
          <div class="tree-zoom" id="tree-zoom">
            <svg class="tree-lines" id="tree-lines" xmlns="http://www.w3.org/2000/svg"></svg>
            <div class="tree-canvas" id="tree-canvas" aria-live="polite"></div>
          </div>
          <div id="tree-status" class="tree-status" aria-live="polite"></div>
        </div>
        <aside class="story-panel" id="story-panel" hidden>
          <div class="story-head">
            <h2 id="story-title">Cerita Keluarga</h2>
            <div class="story-actions">
              <button id="panel-close" class="btn ghost small close-btn" aria-label="Tutup">
                <span aria-hidden="true">×</span>
              </button>
              <button id="panel-edit" class="btn ghost small" data-i18n="modalEdit">Edit</button>
            </div>
          </div>
          <div id="story-content" class="story-content">
            <p id="story-body">Klik pada mana-mana ahli keluarga untuk melihat catatan panjang.</p>
          </div>
          <form class="story-edit" id="panel-edit-form" hidden>
            <label data-i18n="modalFullName">Nama penuh</label>
            <input class="input" id="panel-edit-name" />
            <label data-i18n="firstNameLabel">Nama pertama</label>
            <input class="input" id="panel-edit-first" readonly />
            <label data-i18n="lastNameLabel">Nama akhir</label>
            <input class="input" id="panel-edit-last" readonly />
            <div class="radio-group">
              <span class="label" data-i18n="genderLabel">Jantina</span>
              <label class="radio">
                <input type="radio" name="panel-gender" value="male" disabled />
                <span data-i18n="genderMale">Lelaki</span>
              </label>
              <label class="radio">
                <input type="radio" name="panel-gender" value="female" disabled />
                <span data-i18n="genderFemale">Perempuan</span>
              </label>
            </div>
            <label data-i18n="modalRelation">Hubungan</label>
            <input class="input" id="panel-edit-relation" />
            <label data-i18n="modalBirth">Tarikh lahir</label>
            <input class="input" id="panel-edit-birth" type="date" />
            <label data-i18n="modalDeath">Tarikh meninggal</label>
            <input class="input" id="panel-edit-death" type="date" />
            <label data-i18n="modalImage">URL gambar</label>
            <input class="input" id="panel-edit-photo" />
            <input class="input" id="panel-edit-photo-file" type="file" accept="image/*" />
            <label data-i18n="modalShortNote">Nota ringkas</label>
            <textarea class="textarea" id="panel-edit-note"></textarea>
            <label data-i18n="modalLongStory">Cerita panjang</label>
            <textarea class="textarea" id="panel-edit-story"></textarea>
            <div class="story-edit-actions">
              <button type="button" class="btn ghost" id="panel-cancel" data-i18n="modalCancel">Batal</button>
              <button type="submit" class="btn" data-i18n="modalSave">Simpan</button>
            </div>
          </form>
        </aside>
      </div>
      <section class="timeline-section" id="timeline-section" hidden>
        <div class="timeline-head">
          <h2 data-i18n="timelineTitle">Timeline Keluarga</h2>
        </div>
        <div class="timeline-filters-card">
          <div class="timeline-filters primary">
            <label class="timeline-filter">
              <span data-i18n="timelineMonth">Bulan Lahir</span>
              <select id="timeline-month" class="select"></select>
            </label>
            <label class="timeline-filter">
              <span data-i18n="timelineGender">Jantina</span>
              <select id="timeline-gender" class="select">
                <option value="all" data-i18n="timelineGenderAll">Semua</option>
                <option value="male" data-i18n="timelineGenderMale">Lelaki</option>
                <option value="female" data-i18n="timelineGenderFemale">Perempuan</option>
              </select>
            </label>
            <label class="timeline-filter">
              <span data-i18n="timelineSort">Susun</span>
              <select id="timeline-sort" class="select">
                <option value="year" data-i18n="timelineSortYear">Ikut Tahun</option>
                <option value="alpha" data-i18n="timelineSortAlpha">Ikut Abjad</option>
                <option value="month" data-i18n="timelineSortMonth">Ikut Bulan</option>
                <option value="gender" data-i18n="timelineSortGender">Ikut Jantina</option>
                <option value="parent" data-i18n="timelineSortParent">Ikut Ibu Bapa</option>
              </select>
            </label>
            <button id="timeline-clear" class="btn ghost small timeline-reset" type="button" data-i18n="timelineClear">Reset</button>
          </div>
          <button id="timeline-more-btn" class="timeline-more-btn" type="button" aria-expanded="false" data-i18n="timelineMore">Tapis lagi</button>
          <div id="timeline-more-panel" class="timeline-more-panel" aria-hidden="true">
            <div class="timeline-filters secondary">
              <label class="timeline-filter">
                <span data-i18n="timelineGenLabel">Generasi</span>
                <select id="timeline-gen" class="select"></select>
              </label>
            </div>
          </div>
          <div id="timeline-active-filters" class="timeline-active-filters" hidden></div>
        </div>
        <div class="timeline-list" id="timeline-list"></div>
      </section>
    </main>
  </div>

  <div class="modal" id="person-modal" aria-hidden="true">
    <div class="modal-backdrop" data-close="true"></div>
    <div class="modal-card" role="dialog" aria-modal="true">
      <button class="modal-close" data-close="true" data-i18n="modalClose">Tutup</button>
      <div class="modal-body" id="modal-body"></div>
    </div>
  </div>

  <div class="settings-modal" id="settings-modal" aria-hidden="true">
    <div class="settings-backdrop" data-settings-close="true"></div>
    <div class="settings-card" role="dialog" aria-modal="true" aria-labelledby="settings-title">
      <button class="settings-close" type="button" aria-label="Tutup" data-settings-close="true">×</button>
      <h2 id="settings-title" data-i18n="settingsTitle">Settings</h2>

      <div class="settings-section">
        <h3 data-i18n="settingsDisplay">Paparan</h3>
        <div class="settings-grid">
          <div class="settings-slider">
            <label for="setting-card-scale" class="label" data-i18n="settingsCardSize">Saiz Kad</label>
            <input id="setting-card-scale" type="range" min="0.85" max="1.15" step="0.05" />
            <div class="settings-scale-labels">
              <span data-i18n="settingsSizeSmall">Kecil</span>
              <span data-i18n="settingsSizeNormal">Normal</span>
              <span data-i18n="settingsSizeLarge">Besar</span>
            </div>
          </div>
          <label class="settings-select">
            <span class="label" data-i18n="themePreset">Tema</span>
            <select id="theme-preset" class="select">
              <option value="default" data-i18n="themeDefault">Default</option>
              <option value="heritage" data-i18n="themeHeritage">Heritage</option>
              <option value="ocean" data-i18n="themeOcean">Ocean</option>
              <option value="sunset" data-i18n="themeSunset">Sunset</option>
            </select>
          </label>
          <label class="toggle">
            <input id="toggle-theme" type="checkbox" />
            <span class="toggle-track"></span>
            <span class="toggle-label" data-i18n="themeToggle">Light / Dark</span>
          </label>
          <label class="toggle">
            <input id="lang-toggle" type="checkbox" />
            <span class="toggle-track"></span>
            <span class="toggle-label" data-i18n="langToggle">BM / EN</span>
          </label>
          <label class="toggle">
            <input id="settings-compact" type="checkbox" />
            <span class="toggle-track"></span>
            <span class="toggle-label" data-i18n="settingsCompact">Compact Mode</span>
          </label>
          <label class="toggle">
            <input id="setting-show-birthdate" type="checkbox" />
            <span class="toggle-track"></span>
            <span class="toggle-label" data-i18n="settingsShowBirthdate">Show Birthdate</span>
          </label>
          <label class="toggle">
            <input id="setting-show-age" type="checkbox" />
            <span class="toggle-track"></span>
            <span class="toggle-label" data-i18n="settingsShowAge">Show Age</span>
          </label>
          <label class="toggle">
            <input id="setting-show-tags" type="checkbox" />
            <span class="toggle-track"></span>
            <span class="toggle-label" data-i18n="settingsShowTags">Show Tags</span>
          </label>
        </div>
      </div>

      <div class="settings-section">
        <h3 data-i18n="settingsNav">Navigation</h3>
        <div class="settings-grid">
          <label class="toggle">
            <input id="settings-minimap" type="checkbox" />
            <span class="toggle-track"></span>
            <span class="toggle-label" data-i18n="settingsMinimap">Minimap</span>
          </label>
          <label class="toggle">
            <input id="settings-drag" type="checkbox" />
            <span class="toggle-track"></span>
            <span class="toggle-label" data-i18n="settingsDrag">Drag to Pan</span>
          </label>
        </div>
      </div>

      <div class="settings-section">
        <h3 data-i18n="settingsTools">Tools</h3>
        <div class="settings-grid">
          <button id="setting-reset-settings" class="btn ghost small" type="button" data-i18n="settingsReset">
            Reset settings
          </button>
          <button id="clear-cache" class="btn danger small" type="button" data-i18n="clearCache">
            Clear Cache
          </button>
          <button class="btn ghost small" type="button" data-settings-close="true" data-i18n="settingsClose">
            Close
          </button>
        </div>
      </div>

      <div class="settings-section">
        <h3 data-i18n="settingsAbout">About</h3>
        <div class="settings-about">
          <span data-i18n="settingsDataVersion">Data version</span>
          <strong id="settings-data-version">-</strong>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="app.js?v=20260208" defer></script>
</body>
</html>
